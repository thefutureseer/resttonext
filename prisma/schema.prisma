generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

model User {
  id                 Int                @id @default(autoincrement())
  name               String
  email              String             @unique
  phonenumber        String?
  address            String?
  profilepicture     String?
  orders             Order[]            // One-to-Many: One User can have many Orders
  pastexperiences    Experience[]       // One-to-Many: One User can have many past Experiences
  interactions       Json?              // Interaction history for the ai
  role               role_type @default(user)
  rating             Float?
  preferences        Json?              // User preferences as JSON for the ai
  tags               String[]          // Tags for categorization
  createdat          DateTime           @default(now())
  updated            DateTime           @default(now())
}

model SpiritualLeader {
  id                 Int                @id @default(autoincrement())
  name               String
  expertise          String?
  bio                String?
  profilepicture     String?
  contactinfo        String?
  rating             Float?
  tags               String[]           // Tags for categorization
  pastbeneficiaries  Experience[]       // One-to-Many: One SpiritualLeader can have many past Experiences
  orders             Order[] //link back to order model
  interactions       Json?              // Interaction history for the ai
  role               role_type @default(spiritual_leader)
  createdat          DateTime            @default(now())
  updatedat          DateTime            @default(now())
}

model Order {
  id                 Int                @id @default(autoincrement())
  userid             Int
  user               User               @relation(fields: [userid], references: [id])
  spiritualleaderid  Int
  spiritualleader    SpiritualLeader    @relation(fields: [spiritualleaderid], references: [id])
  problemtosolve     String
  experiencewanted   String
  tags               String[]          // Tags for categorization
  contactvia         ContactMethod
  status             OrderStatus        @default(pending)
  statushistory      Json?              // History of status changes for the ai 
  createdat          DateTime           @default(now())
  updatedat          DateTime           @updatedAt
  experienceid       Int                @unique
  experiences        Experience[]       @relation("OrderExperiences")
}

model Experience {
  id                 Int                @id @default(autoincrement())
  userid             Int
  user               User               @relation(fields: [userid], references: [id])
  spiritualleaderid  Int
  spiritualleader    SpiritualLeader    @relation(fields: [spiritualleaderid], references: [id])
  problemtosolve     String
  experiencewanted   String
  tags               String[]          // Tags for categorization
  statushistory      Json?              // History for the ai
  contactvia         ContactMethod
  createdat          DateTime           @default(now())
  updatedat          DateTime           @default(now())
  orders             Order[]            @relation("OrderExperiences")
  feedback           Json?              // Structured feedback data for the ai
}

enum ContactMethod {
  phone_call
  text_message
  video_call
  in_person
}

enum OrderStatus {
  pending
  completed
  canceled
  resumed_later
}

enum role_type {
  user
  spiritual_leader
  spiritual_leader_admin
  super_admin
  moderator
  support
}